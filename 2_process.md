# 第2章 プロセス

## 2.1 プロセスの概要

### プロセスとは

- カーネルはプロセスという概念を用いて、実行中のプログラムを管理する
    - 1プロセスは1実行プログラム
- プロセスは仮想アドレス空間を持つ
- 一意のプロセスIDを持つ

### プロセスの平行処理

- UNIX V6では複数のユーザが同時にシステムを使用できる
- 物理的なCPUが1つしか存在しないのに複数プログラムを並行して処理できる事をTSS（タイムシェアリングシステム）と呼ぶ
    - 細かい時間で次々と実行するプロセスを切り替える

### プロセスの実行状態

- 実行可能状態なプロセス
- 資源の解放や周辺でバイスの処理完了を待っていて、処理を継続できない休眠状態にあるプロセス

### ユーザモードとカーネルモード

- ユーザモード、カーネルモードはPSWで切り替えられる
    - 切り替わる時、仮想アドレスにマッピングされるメモリ領域が切り替わる
        - ユーザモード、ユーザプログラムが読み込まれているメモリ領域
        - カーネルモード、カーネルプログラムが読み込まれているメモリ領域
    - マッピングの切り替えはMMUが行う
- ユーザモード
    - 仮想アドレス空間をユーザ空間
    - プロセスをユーザプロセス
- カーネルモード
    - 仮想アドレス空間をカーネル空間
    - プロセスをカーネルプロセス
- ユーザプログラムはユーザプロセスによって処理されるため、カーネルプログラムが読み込めない
    - カーネルの機能を実施するにはシステムコールを発行する

### スワッピング

- スワップアウト
    - カーネルが定期的に休眠状態にあるプロセスや重要度の低いプロセス（が扱うデータ）をメモリからスワップ領域に退避する事

- スワップイン
    - スワップアウトされたプロセスのなかで実行可能状態になったプロセスをメモリ領域に復帰する事

- システム起動時に生成されるプロセスによって実行される


## 2.2 proc構造体とuser構造体 

- 各プロセスの状態、制御情報はproc構造体、user構造体の組により管理される
- プロセス毎に1つずつ割り当てられる
- proc構造体はメモリに常駐、user構造体はスワップアウトの対象となる


### proc構造体

- 書籍見る

### user構造体

- 書籍見る

## 2.3 プロセスに割り当てられるメモリ

- 各プロセスにはテキストセグメント、データセグメントという2つの連続した物理メモリ虜域が割り当てられる

### テキストセグメント

- 読み取り専用で機械語が格納されている
- あるプログラムが複数同時に実行される場合は1つのテキストセグメントをプロセス間で共有する

### データセグメント

- プログラムが使用する変数などのデータが格納される
- 複数のプロセス間では共有されない

- PPDA
    - user構造体、カーネルスタック領域からなる
    - カーネルスタック領域は、カーネル処理の作業領域として使用される、プロセス毎

- データ領域
    - グローバス変数などがおかれる領域と、動的にメモリ管理するヒープ領域からなる

- スタック領域
    - 関数の引数や、ローカルデータなどを一時的に格納する領域

### 仮想アドレス空間

- 各プロセスには64Kバイトの仮想アドレス空間が与えられる
- 16ビットの仮想アドレスを用いて物理メモリにアクセス
- MMUによって18ビットの物理アドレスにマッピングされる
